# 云算力资源租用系统设计方案

## 系统概述
云算力资源租用系统是一个专注于管理和分配计算资源的平台，允许学生和教师租用云计算资源进行学习和研究。系统将应用C++的面向对象特性，包括类的构造、聚合、继承、派生以及多态技术，同时保持适当的复杂度。

## 系统功能模块
### 1. 用户模块
- 用户登录（学生、教师、管理员）
- 用户注册（仅学生和教师）
- 个人信息管理
- 密码修改
- 控制台进行消息通知

### 2. 云算力资源模块
- 云算力资源查询
- 云算力资源租用
- 查看个人租用记录
- 取消租用申请

### 3. 管理员模块
- 云算力资源管理（添加、修改、删除）
- 用户管理（查看、添加、修改）
- 租用审核（审核用户的租用申请）
- 查看所有租用记录
- 收费标准设置

### 4. 支付模块
- 云算力资源计费
- 账单生成
- 余额管理

## 数据结构设计

### 1. 用户类层次结构
- 基类：User
  - 属性：ID(string)、姓名(string)、密码(string)、余额(double)、注册时间(time_t)、用户状态(enum UserStatus)
  - 方法：登录验证、修改密码、查看余额、虚析构函数、纯虚函数calculateQuota()
- 派生类：Student
  - 属性：学号(string)、班级(string)、最大配额(int)
- 派生类：Teacher
  - 属性：工号(string)、部门(string)、最大配额(int)
- 派生类：Administrator
  - 属性：权限等级(int)

### 2. 云算力资源类
- CloudResource（资源基类）
  - 属性：资源ID、名称、类型、价格、资源状态(enum ResourceStatus)
  - 方法：利用率统计方法、纯虚函数calculatePrice()、getResourceInfo()
- 派生类：CPUResource（CPU资源）
  - 属性：核心数、频率等
- 派生类：GPUResource（GPU资源）
  - 属性：型号、显存等
- 派生类：StorageResource（存储资源）
  - 属性：容量、读写速度等

### 3. 租用记录类
- Rental（租用记录类）
  - 属性：租用ID、用户ID、资源ID、开始时间、结束时间、费用、租用状态(enum RentalStatus)、审核人ID、审核时间、审核备注

### 4. 支付与计费类
- BillingService（计费服务类）
  - 属性：计费规则表(map<string, double>)、最小计费单位(int)、最长租用时间(int)
  - 方法：计算费用(租用记录)、更新用户余额(用户指针, 金额)、生成账单(租用记录)
  - 职责：根据租用记录计算费用、更新用户余额、生成账单、处理余额不足异常

### 5. 通知服务类
- 通知服务类（NotificationService）
  - 属性：消息列表、消息优先级
  - 方法：
    - 检查租用超时、检查余额不足、添加通知、显示通知、清除通知
  - 职责：负责监控系统中的异常情况（如租用超时、余额不足等），生成相应通知，并在用户登录时按优先级显示提醒信息



## 云算力资源租用规则

### 1. 资源分类与定价
- CPU资源：按核心数和时间计费
- GPU资源：按GPU型号和时间计费
- 存储资源：按容量和时间计费

### 2. 用户权限与优先级
- 教师用户：拥有更高的资源配额和优先级
- 学生用户：拥有基础资源配额

### 3. 计费规则
- 按时间和资源类型计费：当用户归还资源时，系统会计算使用的资源类型和使用时间进行计费
- 最小计费单位：不足1小时按1小时计算
- 最长租用限制：单次租用最长不超过15天（360小时），超时将会释放实例

### 4. 资源分配策略
- 先到先得：在资源充足的情况下按申请顺序分配
- 优先级分配：资源不足时按用户类型优先级分配

### 5. 租用状态流程
1. 申请中：用户提交租用申请
2. 审核通过/拒绝：管理员审核申请
3. 使用中：用户开始使用资源
4. 已完成：用户归还资源，系统计费
5. 已取消：用户取消申请或管理员强制终止

## 系统架构设计

### 1. 文件结构设计
系统使用文件持久化存储数据：
| 文件名 | 用途 |
|--------|------|
| users.dat | 存储用户信息 |
| resources.dat | 存储云算力资源信息 |
| rentals.dat | 存储租用记录 |
| logs.dat | 存储系统操作日志 |

### 2. 系统流程
1. 系统启动，加载所有数据
2. 显示登录/注册界面
3. 用户登录后，根据角色显示不同的功能菜单
4. 用户进行相应操作
5. 系统退出前保存所有数据

### 3. 异常处理机制
- 业务异常处理：
  - 用户余额不足：提示充值，暂停申请处理
  - 资源不足：进入等待队列或推荐替代资源
  - 租用超时：自动释放资源，计算费用，可能限制用户后续使用
- 技术异常处理：
  - 系统故障：记录日志，尝试恢复，必要时通知管理员
  - 自定义异常类层次结构：
    - 基类Exception：包含错误代码、错误信息
    - 派生类ResourceException：资源相关异常
    - 派生类UserException：用户相关异常
    - 派生类SystemException：系统相关异常
  - 使用try-catch机制处理各类异常
  - 实现错误恢复机制：数据回滚、自动重试等

### 4. 安全机制
- 用户安全：密码输入不显示
- 操作安全：记录关键操作日志，便于追踪和审计
- 权限安全：严格控制不同角色的操作权限
- 数据安全：定期备份系统数据，防止数据丢失

## 技术实现

### 1. 面向对象设计特点
- 继承与多态：用户和资源类的层次结构设计
- 封装：各类的属性和方法封装
- 抽象：使用抽象基类和纯虚函数
- 接口设计：定义清晰的类接口，便于扩展

### 2. 实现技术
- 开发语言：C++
- 开发环境：Visual Studio 2022
- 文件操作：使用C++标准库的文件流
- 用户界面：控制台界面，使用字符菜单
- 数据存储：使用二进制文件存储系统数据

### 3. 系统测试计划
- 单元测试：测试各个类和方法的功能
- 集成测试：测试模块间的交互
- 系统测试：测试整个系统的功能和性能
- 用户测试：邀请实际用户测试系统并收集反馈

        